# Default values for devops-genie.
# See charts/devops-genie/README.md for full documentation.

image:
  repository: ghcr.io/devopsgenie-ai/devops-genie
  tag: ""  # defaults to Chart appVersion
  pullPolicy: IfNotPresent
  pullSecrets: []  # e.g. [ghcr] or [{name: ghcr}] for private GHCR

nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  name: ""

# RBAC: ClusterRole + ClusterRoleBinding so the agent can read cluster state (e.g. list pods, get deployments).
# Enable when the agent needs to call the Kubernetes API. Requires serviceAccount.create: true.
rbac:
  create: false
  # Optional: add custom ClusterRole rules (appended to the default read-only rules).
  # extraRules: []

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  capabilities:
    drop:
      - ALL

service:
  type: ClusterIP
  port: 8000

ingress:
  enabled: false
  className: ""
  annotations: {}     # e.g. nginx auth, proxy size/timeouts, CORS, rate limit, external-dns
  hosts:
    - host: devops-genie.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 100m
    memory: 256Mi

# Liveness, readiness and startup probes. Override in values to customize; defaults below match current behavior.
# Set startupProbe to a probe spec (e.g. httpGet /health with failureThreshold) to enable; omit or leave null to disable.
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
# startupProbe: unset by default (no startup probe). Set to a probe spec to enable.
# startupProbe: {}

nodeSelector: {}
tolerations: []
affinity: {}

# Application env vars (see infra_agent README / .env.example).
# Required: ANTHROPIC_API_KEY. Optional: API_KEY (bearer token), GITHUB_PERSONAL_ACCESS_TOKEN,
# INFRA_REPOSITORY, INFRA_FOLDER, CORS_ORIGINS, MAX_TIMEOUT, MAX_REQUEST_SIZE, DEFAULT_MODEL,
# RATE_LIMIT_*, CLAUDE_WRAPPER_HOST, DEBUG_MODE, VERBOSE. Use existingSecret for secrets.
env: {}
#  CORS_ORIGINS: '["*"]'
#  MAX_TIMEOUT: "600000"
#  INFRA_REPOSITORY: "owner/repo"
#  INFRA_FOLDER: "path/to/infra/"

# Use existing secret for sensitive env vars (recommended): ANTHROPIC_API_KEY, API_KEY, GITHUB_PERSONAL_ACCESS_TOKEN.
# When externalSecret.enabled, the operator creates this secret; leave empty to use the ExternalSecret target name.
existingSecret: ""
# existingSecretKeys: {}  # map env name -> secret key

# External Secrets Operator (external-secrets.io): sync secrets from AWS Secrets Manager, Vault, GCP, etc.
# When enabled, do not set existingSecret (deployment uses the synced secret name automatically).
externalSecret:
  enabled: false
  secretStoreRef:
    name: ""              # e.g. aws-secrets-manager, vault-store
    kind: SecretStore     # or ClusterSecretStore
  refreshInterval: 1h     # how often to sync (e.g. "1h", "30m")
  target:
    name: ""              # K8s Secret name to create (default: release fullname)
  # Map external store keys to Secret keys (env var names). Adjust remoteRef to your store.
  data: []
  #  - secretKey: ANTHROPIC_API_KEY
  #    remoteRef:
  #      key: prod/devops-genie
  #      property: anthropic-api-key
  #  - secretKey: GITHUB_PERSONAL_ACCESS_TOKEN
  #    remoteRef:
  #      key: prod/devops-genie
  #      property: github-token
  #  - secretKey: API_KEY
  #    remoteRef:
  #      key: prod/devops-genie
  #      property: api-key
  # Optional: sync entire external secret (all keys). Use instead of data for simple keyâ†’keys mapping.
  dataFrom: []
  #  - key: prod/devops-genie
  #    property: ""   # optional: single property to extract

# GitHub MCP: when Docker socket is not mounted, use the in-image binary (no socket required).
# Set to true for relay-only / locked-down K8s where you do not mount the Docker socket.
# When true, GITHUB_PERSONAL_ACCESS_TOKEN (from existingSecret or env) is still required.
mcp:
  github:
    useBinary: false  # set true when dockerSocket.enabled is false

# Mount Docker socket for MCP (e.g. GitHub). Requires Docker/containerd on node.
# If false, set mcp.github.useBinary: true to run GitHub MCP via in-image binary instead.
dockerSocket:
  enabled: false
  hostPath: /var/run/docker.sock

# Persistence for .claude (optional)
persistence:
  enabled: false
  size: 1Gi
  storageClass: ""

replicaCount: 1
